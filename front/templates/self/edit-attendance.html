<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>考勤</title>
    
    <link href="../../css/mui.min.css" rel="stylesheet"/>
    <link href="../../css/style.css" rel="stylesheet"/>
    <link href="../../css/iconfont.css" rel="stylesheet"/>
    <link href="../../css/mui.picker.css" rel="stylesheet" />
	<link href="../../css/mui.poppicker.css" rel="stylesheet" />
    <script src="../../js/mui.min.js"></script>
	<script src="../../js/mui.picker.js"></script>
	<script src="../../js/mui.poppicker.js"></script>
</head>
<body>
<header class="mui-bar mui-bar-nav">
	<button class="mui-action-back mui-btn mui-btn-blue mui-btn-link mui-btn-nav mui-pull-left"><span class="mui-icon mui-icon-left-nav"></span>我的</button>
	<button id="submit" class="mui-btn mui-btn-blue mui-btn-link mui-pull-right">完成</button>
	<h1 class="mui-title"></h1>
</header>
<style type="text/css">
	.mui-btn-block{
		margin-bottom: 0px;
	}
	.fixed-word{
		float: left;
		margin-left: 20px;
		color: #737373;
	}
	.ajax-word{
		margin-right: 5px;
		float: right;
	}
</style>
<div class="mui-content">
	<ul class="mui-table-view mui-table-view-chevron" >
		<li class="mui-table-view-cell mui-media">
			<img class="mui-media-object mui-pull-left head-img" id="head-img" src="../../favicon.ico">
			<div class="mui-media-body">
				小明
				<p class='mui-ellipsis'>账号:xiaoming</p>
			</div>
		</li>
	</ul>
	<ul class="mui-table-view mui-table-view-chevron" >
		<li class="mui-table-view-cell mui-media" id="typePicker">
			<span class="fixed-word">请假类型</span><span id="type" class="ajax-word">请选择请假类型</span>
		</li>
		<li class="mui-table-view-cell mui-media" id="startdayPicker">
			<span class="fixed-word">开始日期</span><span id="startday" class="ajax-word">请选择开始日期</span>
		</li>
		<li class="mui-table-view-cell mui-media" id="enddayPicker">
			<span class="fixed-word">结束日期</span><span id="endday" class="ajax-word">请选择结束日期</span>
		</li>
	</ul>
	<div class="mui-input-row" style="margin: 10px 5px;">
		<textarea id="reason" rows="5" placeholder="请输入请假原因"></textarea>
	</div>
</div>
	

<script type="text/javascript">
	mui.plusReady(function() {
		var self = plus.webview.currentWebview();
		var title = self.title;
		document.getElementsByClassName('mui-title')[0].innerHTML = title;
	});
	(function($, doc) {
		$.init();
		$.ready(function() {
			var holidayid = '', startday = '', endday = '', remainday = 0;
			//载入请假类型
			var typePicker = new $.PopPicker();
			var storage = window.localStorage;
			var root = storage.getItem("root");
			mui.ajax(root+"attendance/holiday/getOneHoli/", {
				dataType:'json',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:5000,//超时时间设置为5秒；
				success:function(data){
					typePicker.setData(data.RList);
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
					mui.toast('网络异常');
				}
			});
		
			
			typePicker.setData([{
	            "id": 1,
	            "holidayid": "0",
	            "remainday": null,
	            "lastday": "10000",
	            "holidayname": "事假",
	            "holidayproperity": 1
	        },
	        {
	            "id": 2,
	            "holidayid": "1",
	            "remainday": 9996,
	            "lastday": "10000",
	            "holidayname": "病假",
	            "holidayproperity": 1
	        },
	        {
	            "id": 3,
	            "holidayid": "2",
	            "remainday": null,
	            "lastday": "7",
	            "holidayname": "婚假1",
	            "holidayproperity": 0
	        },
	        {
	            "id": 6,
	            "holidayid": "5",
	            "remainday": null,
	            "lastday": "7",
	            "holidayname": "陪产假",
	            "holidayproperity": 0
	        },
	        {
	            "id": 7,
	            "holidayid": "6",
	            "remainday": null,
	            "lastday": "10",
	            "holidayname": "年假1",
	            "holidayproperity": 0
	        },
	        {
	            "id": 9,
	            "holidayid": "8",
	            "remainday": null,
	            "lastday": "10000",
	            "holidayname": "出差",
	            "holidayproperity": 0
	        }]);
			var typePickerButton = doc.getElementById('typePicker');
			typePickerButton.addEventListener('tap', function(event) {
				typePicker.show(function(items) {
					holidayid = items[0].id;
					doc.getElementById('type').innerHTML = items[0].text;
					//返回 false 可以阻止选择框的关闭
					//return false;
				});
			}, false);
			
			document.getElementById("startdayPicker").addEventListener('tap', function() {
				var dDate = new Date();
				//dDate.setFullYear(2014, 7, 16);
				var minDate = new Date();

				var maxDate = new Date();
				maxDate.setFullYear(2016, 11, 31);
				var startDateResult = document.getElementById('startday');
				plus.nativeUI.pickDate(function(e) {
					var d = e.date;
					startDateResult.innerHTML = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate();
					startday = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate();
				}, function(e) {
					//startDateResult.innerHTML = "请选择开始日期";
				}, {
					title: "请选择日期",
					date: dDate,
					minDate: minDate
				});
			});
			
			document.getElementById("enddayPicker").addEventListener('tap', function() {
				var dDate = new Date();
				//dDate.setFullYear(2014, 7, 16);
				var minDate = new Date();

				var maxDate = new Date();
				maxDate.setFullYear(2016, 11, 31);
				var endDateResult = document.getElementById('endday');
				plus.nativeUI.pickDate(function(e) {
					var d = e.date;
					endDateResult.innerHTML = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate();
					endday = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate();
				}, function(e) {
					//endDateResult.innerHTML = "请选择结束日期";
				}, {
					title: "请选择日期",
					date: dDate,
					minDate: minDate
				});
			});
			
			document.getElementById("submit").addEventListener("tap", function(){
				if(holidayid == ''){
					mui.toast("请选择请假类型");
					return;
				}
				if(startday == ''){
					mui.toast("请选择开始日期");
					return;
				}
				if(endday == ''){
					mui.toast("请选择结束日期");
					return;
				}
				var reason = document.getElementById("reason").value;
				if(reason == ""){
					mui.toast("请输入请假原因");
					return;
				}
				var storage = window.localStorage;
				var root = storage.getItem('root');
				mui.ajax(root+"../../js/data/"+holidayid+"/"+startday+"/"+endday+"/"+reason, {
					dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型
					timeout:5000,//超时时间设置为5秒；
					success:function(data){
						//服务器返回响应，根据响应结果，分析是否登录成功；
						if(data.status == 'OK'){
							mui.back();
							mui.toast('请假成功');
						}else{
							mui.toast('请假失败，请重试');
						}
					},
					error:function(xhr,type,errorThrown){
						//异常处理；
						mui.toast('网络异常');
					}
				});
			
			});
			
		});
	})(mui, document);
	
</script>
</body>
</html>